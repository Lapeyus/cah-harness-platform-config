inputSet:
  name: best_app_ever Inputs
  identifier: best_app_ever_inputs
  orgIdentifier: default
  projectIdentifier: spark
  pipeline:
    identifier: gradle_build_deploy_pipeline
    template:
      templateInputs:
        variables:
          - name: APP_NAME
            value: 'best_app_ever'
          - name: DR_ENABLED
            value: false
          - name: LANGUAGE_VERSION
            value: 16
          - name: NOTIFICATION_EMAIL
            value: team@example.com
          - name: GITOPS_APP_NAME
            value: 'best_app_ever'
        properties:
          ci:
            codebase:
              repoName: cpcn3041_argocd-ent_app-of-apps
              build: <+input>
        stages:
          - stage:
              identifier: build
              template:
                templateInputs:
                  variables:
                    - name: DOCKERFILE
                      value: Dockerfile
          - parallel:
              - stage:
                  identifier: Deploy_DEV
                  template:
                    templateInputs:
                      variables:
                        - name: STAGE_ENABLED
                          value: 'true'
                        - name: GITOPS_APP_NAME
                          value: 'best_app_ever'
                      spec:
                        service:
                          serviceRef: bast_app_ever
                          serviceInputs:
                            serviceDefinition:
                              type: Kubernetes
                              spec:
                                artifacts:
                                  primary:
                                    primaryArtifactRef: poc_image
                        execution:
                          steps:
                            - step:
                                identifier: updateReleaseRepo
                                spec:
                                  variables:
                                    - name: image.tag
                                      value: <+pipeline.variables.IMAGE_TAG>
                            - step:
                                identifier: QA_Approval
                                spec:
                                  approvers:
                                    userGroups:
                                      - account.a_OktaSSO_APM0031732_admins
                        environment:
                          environmentRef: org.dev
                          deployToAll: false
                          environmentInputs: <+input>
                          gitOpsClusters:
                            - identifier: mycluster
          - stage:
              identifier: Deploy_QA
              template:
                templateInputs:
                  variables:
                    - name: STAGE_ENABLED
                      value: 'true'
                    - name: GITOPS_APP_NAME
                      value: 'best_app_ever'
                  spec:
                    execution:
                      steps:
                        - step:
                            identifier: updateReleaseRepo
                            spec:
                              variables:
                                - name: image.tag
                                  value: <+pipeline.variables.IMAGE_TAG>
                        - step:
                            identifier: QA_Approval
                            spec:
                              approvers:
                                userGroups:
                                  - account.a_OktaSSO_APM0031732_admins
                    environment:
                      environmentRef: org.qa
                      deployToAll: true
                      environmentInputs: <+input>
                      gitOpsClusters:
                        - identifier: mycluster
          - stage:
              identifier: release
              template:
                templateInputs:
                  spec:
                    execution:
                      steps:
                        - step:
                            identifier: Generate_Version
                            spec:
                              envVariables:
                                RELEASE_TAG: <+input>.executionInput().default(<+execution.steps.Increment_Version.output.outputVariables.RELEASE_VERSION>).regex((v\d{0,4}\.\d{0,4}\.\d{0,4}|<\+execution.steps.Increment_Version.output.outputVariables.RELEASE_VERSION>))
          - stage:
              identifier: Deploy_STG
              template:
                templateInputs:
                  variables:
                    - name: STAGE_ENABLED
                      value: 'true'
                  spec:
                    execution:
                      steps:
                        - step:
                            identifier: updateReleaseRepo
                            spec:
                              variables:
                                - name: image.tag
                                  value: <+pipeline.variables.IMAGE_TAG>
                        - step:
                            identifier: QA_Approval
                            spec:
                              approvers:
                                userGroups:
                                  - account.a_OktaSSO_APM0031732_admins
                    environment:
                      environmentRef: org.stg
                      deployToAll: true
                      environmentInputs: <+input>
                      gitOpsClusters:
                        - identifier: mycluster
          - stage:
              identifier: Change_Management
              template:
                templateInputs:
                  variables:
                    - name: CHG_OR_INC_NUMBER
                      value: <+input>.executionInput()
          - stage:
              identifier: Deploy_PRD
              template:
                templateInputs:
                  variables:
                    - name: STAGE_ENABLED
                      value: 'true'
                  spec:
                    execution:
                      steps:
                        - step:
                            identifier: updateReleaseRepo
                            spec:
                              variables:
                                - name: image.tag
                                  value: <+pipeline.variables.IMAGE_TAG>
                        - step:
                            identifier: QA_Approval
                            spec:
                              approvers:
                                userGroups:
                                  - account.a_OktaSSO_APM0031732_admins
                    environment:
                      environmentRef: org.prd
                      deployToAll: true
                      environmentInputs: <+input>
                      gitOpsClusters:
                        - identifier: mycluster
          - stage:
              identifier: Deploy_DR
              template:
                templateInputs:
                  variables:
                    - name: STAGE_ENABLED
                      value: false
                    - name: GITOPS_APP_NAME
                      value: 'best_app_ever'
                  spec:
                    execution:
                      steps:
                        - step:
                            identifier: updateReleaseRepo
                            spec:
                              variables:
                                - name: image.tag
                                  value: <+pipeline.variables.IMAGE_TAG>
                        - step:
                            identifier: QA_Approval
                            spec:
                              approvers:
                                userGroups:
                                  - account.a_OktaSSO_APM0031732_admins
                    environment:
                      environmentRef: org.dr
                      deployToAll: true
                      environmentInputs: <+input>
                      gitOpsClusters:
                        - identifier: mycluster
